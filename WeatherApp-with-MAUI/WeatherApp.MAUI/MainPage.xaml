<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="WeatherApp.MAUI.MainPage"
             Title="Weather App">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="40" />
            <RowDefinition Height="*" />
            <RowDefinition Height="40" />
        </Grid.RowDefinitions>

        <!--Header-->
        <StackLayout  Grid.Row="0">
            <Grid x:Name="Header">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="400" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="200" />
                </Grid.ColumnDefinitions>

                <!--MAUI Link-->
                <HorizontalStackLayout Grid.Column="0" HorizontalOptions="Start">
                    <Border
                        HeightRequest="38" 
                        WidthRequest="120" 
                        Margin="30, 0, 0, 0"
                        Padding="0"
                        Stroke="Transparent"
                        StrokeThickness="0"
                        StrokeShape="RoundRectangle 20">
                        <Image
                            x:Name="Logo"
                            Margin="0"
                            VerticalOptions="Center"
                            HorizontalOptions="Center"
                            IsAnimationPlaying="True" 
                            Source="logo.gif"/>
                    </Border>
                    <Label Margin="5,5,30,0">
                        <Label.GestureRecognizers>
                            <TapGestureRecognizer Tapped="MAUI_ClickHandler"/>
                            <PointerGestureRecognizer PointerEntered="PointerEntered"/>
                            <PointerGestureRecognizer PointerExited="PointerExited"/>
                        </Label.GestureRecognizers>
                        Weather App with MAUI
                    </Label>
                </HorizontalStackLayout>

                <!--Toggle Theme-->
                <Switch
                    x:Name="ToggleThemeSwitch"
                    Grid.Column="2" 
                    HorizontalOptions="End"
                    Margin="30,-2,30,0"
                    Toggled="ToggleTheme_ClickHandler"/>
            </Grid>

            <!--Top Separator-->
            <BoxView HeightRequest="1" Color="Red" VerticalOptions="End"/>
        </StackLayout>

        <!--Body-->
        <Grid x:Name="Body" Grid.Row="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="150" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <StackLayout Grid.Row="0">

                <!--City Input-->
                <Entry
                   x:Name="CityInput" 
                   Margin="0, 30, 0, 0"
                   HeightRequest="30"
                   WidthRequest="255"
                   Background="White"
                   HorizontalOptions="Center"
                   TextColor="Black"
                   TextChanged="CityInput_ChangeHandler"/>

                <!--Search Button-->
                <Button 
                    x:Name="SearchBtn"
                    Text="Search" 
                    Margin="0, 15, 0, 0"
                    HeightRequest="30"
                    WidthRequest="255"
                    BorderWidth="2"
                    CornerRadius="20"
                    TextColor="{Binding TextColor}"
                    BorderColor="{Binding TextColor}"
                    Background="{Binding BackgroundColor}"
                    Clicked="SearchBtn_ClickHandler" />
            </StackLayout>

            <!--Weather Info-->
            <Grid 
                Grid.Row="1"
                IsVisible="{Binding HasCity}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="180" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!--General Info-->
                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!--WeatherIconBackground-->
                    <Ellipse 
                        Grid.Column="0"
                        HorizontalOptions="End"
                        Margin="0, -90, 40, 0"
                        HeightRequest="70"
                        WidthRequest="70"
                        Fill="Gray" />

                    <!--WeatherIcon-->
                    <Image 
                        Grid.Column="0"
                        HeightRequest="80" 
                        WidthRequest="77" 
                        HorizontalOptions="End" 
                        Margin="0, -90, 36, 0"
                        Source="{Binding Icon}"/>

                    <!--CityNameAndCountry-->
                    <Label 
                        Grid.Column="1" 
                        HorizontalOptions="Start" 
                        Margin="-20, 25, 0, 0" 
                        FontSize="30" 
                        Text="{Binding GeneralInfo.NameAndCountry}" />

                </Grid>

                <!--Description-->
                <Label 
                    Grid.Row="0" 
                    HorizontalOptions="Center" 
                    Margin="0, 80, 0, 0"
                    Text="{Binding GeneralInfo.Description}" />

                <!--Temperature-->
                <Label 
                   Grid.Row="0" 
                   HorizontalOptions="Center" 
                   Margin="0, 95, 0, 5"
                   FontSize="50"
                   Text="{Binding GeneralInfo.Temperature}" />

                <!--FeelsLike-->
                <Label 
                    Grid.Row="0" 
                    HorizontalOptions="Center" 
                    Margin="0, 155, 0, 0"
                    Text="{Binding GeneralInfo.FeelsLike}" />

                <!--InfoCards-->
                <Grid x:Name="InfoCards" Grid.Row="1">
                    <Grid.Resources>
                        <!--Image styles-->
                        <Style TargetType="Image">
                            <Setter Property="WidthRequest" Value="30"/>
                            <Setter Property="HeightRequest" Value="30"/>
                            <Setter Property="HorizontalOptions" Value="Center"/>
                            <Setter Property="Margin" Value="0, -3, 5, 0"/>
                        </Style>

                        <Style TargetType="FlexLayout">
                            <Setter Property="HorizontalOptions" Value="Center"/>
                            <Setter Property="Margin" Value="0, 9, 0, 0"/>
                        </Style>

                        <Style TargetType="Border">
                            <Setter Property="HeightRequest" Value="40" />
                            <Setter Property="WidthRequest" Value="330" />
                            <Setter Property="StrokeShape" Value="RoundRectangle 5" />
                            <Setter Property="StrokeThickness" Value="1" />
                            <Setter Property="Stroke" Value="{Binding TextColor}" />
                        </Style>

                        <Style TargetType="Label">
                            <Setter Property="Margin" Value="0"/>
                            <Setter Property="TextColor" Value="{Binding TextColor}"/>
                        </Style>
                    </Grid.Resources>

                    <Grid.RowDefinitions>
                        <RowDefinition Height="60" />
                        <RowDefinition Height="60" />
                    </Grid.RowDefinitions>

                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!--InfoCard Pressusre-->
                    <Border Grid.Row="0" Grid.Column="0">
                        <FlexLayout>
                            <Image 
                                HeightRequest="33"
                                WidthRequest="33"
                                Margin="0, -4, 7, 0"
                                Source="{Binding InfoCards[0].Icon}"/>

                            <Label Text="{Binding InfoCards[0].Content}" />
                        </FlexLayout>
                    </Border>

                    <!--InfoCard Humidity-->
                    <Border Grid.Row="0" Grid.Column="1">
                        <FlexLayout>
                            <Image Source="{Binding InfoCards[1].Icon}"/>
                            <Label Text="{Binding InfoCards[1].Content}" />
                        </FlexLayout>
                    </Border>
                    
                </Grid>
            </Grid>

            <!--NotFound-->
            <Border
               Grid.Row="1"
               WidthRequest="950"
               HeightRequest="150"
               StrokeThickness="2"
               Stroke="Red"
               StrokeShape="RoundRectangle 10"
               IsVisible="{Binding NotFound}">
                <Grid Height="500">
                    <Grid.Resources>
                        <Style TargetType="Label">
                            <Setter Property="Grid.Column" Value="1"/>
                            <Setter Property="FontSize" Value="30"/>
                            <Setter Property="TextColor" Value="red"/>
                        </Style>
                    </Grid.Resources>

                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="310"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Image 
                       Grid.Column="0"
                       WidthRequest="100"
                       HeightRequest="100"
                       Source="cancel.png"/>

                    <VerticalStackLayout Grid.Column="1">
                        <HorizontalStackLayout>
                            <Label Margin="0, 20">
                                Invalid city name provided:
                            </Label>

                            <Label
                               Margin="20, 20"
                               FontAttributes="Bold"
                               Text="{Binding City}"/>
                        </HorizontalStackLayout>

                        <Label Margin="10">
                            Please enter a valid city name!
                        </Label>
                    </VerticalStackLayout>
                </Grid>
            </Border>
            
            <!--LoadingSpinner-->
            <ActivityIndicator
                x:Name="LoadingSpinner"
                Grid.Row="1"
                HeightRequest="150"
                WidthRequest="150"
                Color="CornflowerBlue"
                IsRunning="{Binding Loading}" />

        </Grid>

        <!--Footer-->
        <StackLayout  Grid.Row="2">

            <!--Bottom Separator-->
            <BoxView HeightRequest="1" Color="Red"/>

            <!--Links-->
            <Grid x:Name="Footer">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="200" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="200" />
                </Grid.ColumnDefinitions>

                <!--Data Provider Link-->
                <Label 
                    Grid.Column="0"
                    HorizontalOptions="Start" 
                    Margin="30,8,30,0">
                    <Label.GestureRecognizers>
                        <TapGestureRecognizer Tapped="DataProvider_ClickHandler"/>
                        <PointerGestureRecognizer PointerEntered="PointerEntered"/>
                        <PointerGestureRecognizer PointerExited="PointerExited"/>
                    </Label.GestureRecognizers>
                    Data Provider
                </Label>

                <!--Export Data-->
                <HorizontalStackLayout 
                    HorizontalOptions="Center"
                    Grid.Column="1"
                    IsVisible="{Binding HasCity}">
                    <Label 
                        Margin="0, 5, 10, 5"
                        Text="💾 Export Data"/>
                    <StackLayout 
                        HeightRequest="30" 
                        Margin="0, 5, 0, 0">
                        <Picker 
                            x:Name="FileFormatPicker" 
                            HorizontalOptions="Center" 
                            Margin="0, -7, 0, 0"
                            FlowDirection="LeftToRight"
                            BackgroundColor="AliceBlue"
                            TextColor="Black"
                            SelectedIndexChanged="FileFormatPicker_SelectionHandler">
                            <Picker.Items>
                                <x:String>JSON</x:String>
                                <x:String>XML</x:String>
                            </Picker.Items>
                        </Picker>
                    </StackLayout>
                </HorizontalStackLayout>

                <!--Source Code Link-->
                <Label 
                    Grid.Column="2"
                    HorizontalOptions="End" 
                    Margin="30,8,30,0">
                    <Label.GestureRecognizers>
                        <TapGestureRecognizer Tapped="SourceCode_ClickHandler"/>
                        <PointerGestureRecognizer PointerEntered="PointerEntered"/>
                        <PointerGestureRecognizer PointerExited="PointerExited"/>
                    </Label.GestureRecognizers>
                    Source Code
                </Label>
            </Grid>
        </StackLayout>
    </Grid>

</ContentPage>
